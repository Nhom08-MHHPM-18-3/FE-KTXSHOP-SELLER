{"ast":null,"code":"var _jsxFileName = \"/home/hao/Deadline/mhhpm_18_3_final/FE-KTXSHOP-SELLER/pages/cms/product/index.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Button, Paper, Table, TableBody, TableCell, TableContainer, TableHead, TableRow, Tooltip } from \"@material-ui/core\";\nimport Grid from \"@material-ui/core/Grid\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport InputBase from \"@material-ui/core/InputBase\";\nimport EditIcon from \"@material-ui/icons/Edit\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { doWithLoggedInUser, renderWithLoggedInUser } from \"../../../lib/login\";\nimport MyTablePagination from \"../../../component/my-pagination/my-pagination\"; // import { getProductClient } from \"client/product\";\n\nimport { formatEllipsisText, formatUrlSearch } from \"../../../utils/func\";\nimport Head from \"next/head\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport Router, { useRouter } from \"next/router\";\nimport React, { useEffect, useState } from \"react\";\nimport styles from \"./product.module.css\";\nimport { MyCard, MyCardActions, MyCardHeader } from \"../../../component/my-card/my-card\";\nconst LIMIT = 20;\nexport async function getServerSideProps(ctx) {\n  let start = +new Date();\n  let result = await doWithLoggedInUser(ctx, ctx => {\n    return loadProductData(ctx);\n  });\n  return result;\n}\nexport async function loadProductData(ctx) {\n  let data = {\n    props: {\n      data: []\n    }\n  };\n  await fetch(process.env.API_HOST + '/api/products').then(response => response.json()).then(res => {\n    data.props.count = res.meta.pagination.total;\n    res.data.map(item => {\n      data.props.data.push(_objectSpread(_objectSpread({}, item.attributes), {}, {\n        id: item.id\n      }));\n    });\n  });\n  return data;\n}\nexport function getFirstImage(val) {\n  if (val && val.length > 0) {\n    return val[0];\n  }\n\n  return `/default.png`;\n}\nexport default function ProductPage(props) {\n  return renderWithLoggedInUser(props, render);\n}\n\nfunction render(props) {\n  let router = useRouter();\n  let {\n    0: search,\n    1: setSearch\n  } = useState(\"\");\n  let {\n    0: data,\n    1: setData\n  } = useState(props);\n  let {\n    0: page,\n    1: setPage\n  } = useState(parseInt(router.query.page) || 0);\n  let {\n    0: limit,\n    1: setLimit\n  } = useState(parseInt(router.query.limit) || LIMIT);\n  let q = router.query.search || \"\";\n  useEffect(() => {\n    setData(props);\n    setSearch(router.query.search || \"\");\n    setPage(parseInt(router.query.page) || 0);\n    setLimit(parseInt(router.query.limit) || LIMIT);\n  }, [props.data]);\n\n  async function handleChange(event) {\n    const target = event.target;\n    const value = target.value;\n    setSearch(value);\n  }\n\n  async function onSearch() {\n    q = formatUrlSearch(search);\n    router.push(`?search=${q}`);\n  }\n\n  async function deleteProduct(id) {\n    await fetch(process.env.API_HOST + \"/api/products/\" + id, {\n      method: 'DELETE'\n    }).then(response => response.json()).then(res => console.log(res));\n    let productList = [...data.data];\n    setData({\n      data: productList.filter(v => v.id != id),\n      count: data.count - 1\n    });\n  }\n\n  return __jsx(\"div\", {\n    select: \"/cms/product\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }\n  }, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }\n  }, __jsx(\"title\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 17\n    }\n  }, \"Danh s\\xE1ch s\\u1EA3n ph\\u1EA9m\")), __jsx(MyCard, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 13\n    }\n  }, __jsx(MyCardHeader, {\n    title: \"Danh s\\xE1ch s\\u1EA3n ph\\u1EA9m\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 17\n    }\n  }, __jsx(Link, {\n    href: \"/cms/product/new\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 21\n    }\n  }, __jsx(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 25\n    }\n  }, __jsx(FontAwesomeIcon, {\n    icon: faPlus,\n    style: {\n      marginRight: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 29\n    }\n  }), \"Th\\xEAm s\\u1EA3n ph\\u1EA9m\"))), __jsx(MyCardActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 17\n    }\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 21\n    }\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    md: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 25\n    }\n  }, __jsx(Paper, {\n    className: styles.search,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 29\n    }\n  }, __jsx(InputBase, {\n    id: \"q\",\n    name: \"q\",\n    className: styles.input,\n    value: search,\n    onChange: handleChange,\n    onKeyPress: event => {\n      if (event.key === \"Enter\") {\n        onSearch();\n      }\n    },\n    autoComplete: \"off\",\n    placeholder: \"Nh\\u1EADp t\\xEAn ho\\u1EB7c m\\xE3 s\\u1EA3n ph\\u1EA9m\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 33\n    }\n  }), __jsx(IconButton, {\n    className: styles.iconButton,\n    \"aria-label\": \"search\",\n    onClick: onSearch,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 33\n    }\n  }, __jsx(SearchIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 37\n    }\n  })))), __jsx(Grid, {\n    item: true,\n    xs: 6,\n    sm: 3,\n    md: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 25\n    }\n  })))), __jsx(TableContainer, {\n    component: Paper,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 13\n    }\n  }, __jsx(Table, {\n    size: \"small\",\n    \"aria-label\": \"a dense table\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 17\n    }\n  }, __jsx(TableHead, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 21\n    }\n  }, __jsx(TableRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 25\n    }\n  }, __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 29\n    }\n  }, \"ID\"), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 29\n    }\n  }, \"H\\xECnh \\u1EA3nh\"), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 29\n    }\n  }, \"T\\xEAn s\\u1EA3n ph\\u1EA9m\"), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 29\n    }\n  }, \"M\\xF4 t\\u1EA3\"), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 29\n    }\n  }, \"Lo\\u1EA1i\"), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 29\n    }\n  }, \"Gi\\xE1\"), __jsx(TableCell, {\n    align: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 29\n    }\n  }, \"Thao t\\xE1c\"))), data.count <= 0 ? __jsx(TableRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 25\n    }\n  }, __jsx(TableCell, {\n    colSpan: 5,\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 29\n    }\n  })) : __jsx(TableBody, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 29\n    }\n  }, data.data.map((row, i) => __jsx(TableRow, {\n    key: i,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 37\n    }\n  }, __jsx(TableCell, {\n    component: \"th\",\n    scope: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 41\n    }\n  }, row.id), __jsx(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 41\n    }\n  }, __jsx(Image, {\n    src: row.imageUrl ? row.imageUrl : \"/\",\n    title: \"image\",\n    alt: \"image\",\n    width: 60,\n    height: 60,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 45\n    }\n  })), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 41\n    }\n  }, formatEllipsisText(row.name)), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 41\n    }\n  }, row.description), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 41\n    }\n  }, row.categoryId), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 41\n    }\n  }, row.price, \" vn\\u0111\"), __jsx(TableCell, {\n    align: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 41\n    }\n  }, __jsx(Link, {\n    href: `/cms/product/edit?productId=${row.id}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 45\n    }\n  }, __jsx(\"a\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 49\n    }\n  }, __jsx(Tooltip, {\n    title: \"C\\u1EADp nh\\u1EADt th\\xF4ng tin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 53\n    }\n  }, __jsx(IconButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 57\n    }\n  }, __jsx(EditIcon, {\n    fontSize: \"small\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 61\n    }\n  }))))), __jsx(Tooltip, {\n    title: \"X\\xF3a s\\u1EA3n ph\\u1EA9m\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 45\n    }\n  }, __jsx(IconButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 49\n    }\n  }, __jsx(DeleteIcon, {\n    onClick: () => deleteProduct(row.id),\n    fontSize: \"small\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 53\n    }\n  }))))))), data.count > 0 ? __jsx(MyTablePagination, {\n    labelUnit: \"s\\u1EA3n ph\\u1EA9m\",\n    count: data.count,\n    rowsPerPage: limit,\n    page: page,\n    onChangePage: (event, page, rowsPerPage) => {\n      Router.push(`/cms/product?page=${page}&limit=${rowsPerPage}&search=${search}`);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 25\n    }\n  }) : __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 29\n    }\n  }))));\n}","map":{"version":3,"sources":["/home/hao/Deadline/mhhpm_18_3_final/FE-KTXSHOP-SELLER/pages/cms/product/index.js"],"names":["Button","Paper","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Tooltip","Grid","IconButton","InputBase","EditIcon","DeleteIcon","SearchIcon","faPlus","FontAwesomeIcon","doWithLoggedInUser","renderWithLoggedInUser","MyTablePagination","formatEllipsisText","formatUrlSearch","Head","Image","Link","Router","useRouter","React","useEffect","useState","styles","MyCard","MyCardActions","MyCardHeader","LIMIT","getServerSideProps","ctx","start","Date","result","loadProductData","data","props","fetch","process","env","API_HOST","then","response","json","res","count","meta","pagination","total","map","item","push","attributes","id","getFirstImage","val","length","ProductPage","render","router","search","setSearch","setData","page","setPage","parseInt","query","limit","setLimit","q","handleChange","event","target","value","onSearch","deleteProduct","method","console","log","productList","filter","v","marginRight","input","key","iconButton","row","i","imageUrl","name","description","categoryId","price","rowsPerPage"],"mappings":"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","sourcesContent":["import { Button, Paper, Table, TableBody, TableCell, TableContainer, TableHead, TableRow, Tooltip } from \"@material-ui/core\";\nimport Grid from \"@material-ui/core/Grid\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport InputBase from \"@material-ui/core/InputBase\";\nimport EditIcon from \"@material-ui/icons/Edit\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { doWithLoggedInUser, renderWithLoggedInUser } from \"../../../lib/login\";\nimport MyTablePagination from \"../../../component/my-pagination/my-pagination\";\n// import { getProductClient } from \"client/product\";\nimport { formatEllipsisText, formatUrlSearch } from \"../../../utils/func\";\nimport Head from \"next/head\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport Router, { useRouter } from \"next/router\";\nimport React, { useEffect, useState } from \"react\";\nimport styles from \"./product.module.css\";\nimport { MyCard, MyCardActions, MyCardHeader } from \"../../../component/my-card/my-card\";\n\nconst LIMIT = 20;\n\nexport async function getServerSideProps(ctx) {\n    let start = +new Date()\n    let result = await doWithLoggedInUser(ctx, (ctx) => {\n        return loadProductData(ctx);\n    });\n    return result\n}\n\nexport async function loadProductData(ctx) {\n    let data = { props: { data: [] } }\n    await fetch(process.env.API_HOST + '/api/products')\n        .then(response => response.json())\n        .then(res => {\n            data.props.count = res.meta.pagination.total\n            res.data.map(item => {\n                data.props.data.push({ ...item.attributes, id: item.id })\n            })\n        });\n    return data\n}\n\nexport function getFirstImage(val) {\n    if (val && val.length > 0) {\n        return val[0];\n    }\n    return `/default.png`;\n}\n\nexport default function ProductPage(props) {\n    return renderWithLoggedInUser(props, render);\n}\n\nfunction render(props) {\n    let router = useRouter();\n    let [search, setSearch] = useState(\"\");\n    let [data, setData] = useState(props);\n    let [page, setPage] = useState(parseInt(router.query.page) || 0);\n    let [limit, setLimit] = useState(parseInt(router.query.limit) || LIMIT);\n    let q = router.query.search || \"\";\n\n    useEffect(() => {\n        setData(props);\n        setSearch(router.query.search || \"\");\n        setPage(parseInt(router.query.page) || 0);\n        setLimit(parseInt(router.query.limit) || LIMIT);\n    }, [props.data]);\n\n    async function handleChange(event) {\n        const target = event.target;\n        const value = target.value;\n        setSearch(value);\n    }\n\n    async function onSearch() {\n        q = formatUrlSearch(search);\n        router.push(`?search=${q}`);\n    }\n\n    async function deleteProduct(id) {\n        await fetch(process.env.API_HOST + \"/api/products/\" + id, {\n            method: 'DELETE',\n        }).then(response => response.json())\n            .then(res => console.log(res));\n        let productList = [...data.data]\n        setData({ data: productList.filter((v) => v.id != id), count: data.count - 1 })\n    }\n\n    return (\n        <div select=\"/cms/product\" >\n            <Head>\n                <title>Danh sách sản phẩm</title>\n            </Head>\n            <MyCard>\n                <MyCardHeader title=\"Danh sách sản phẩm\">\n                    <Link href=\"/cms/product/new\">\n                        <Button variant=\"contained\" color=\"primary\">\n                            <FontAwesomeIcon icon={faPlus} style={{ marginRight: 8 }} />Thêm sản phẩm\n                        </Button>\n                    </Link>\n                </MyCardHeader>\n                <MyCardActions>\n                    <Grid container spacing={3}>\n                        <Grid item xs={12} md={4}>\n                            <Paper className={styles.search}>\n                                <InputBase\n                                    id=\"q\"\n                                    name=\"q\"\n                                    className={styles.input}\n                                    value={search}\n                                    onChange={handleChange}\n                                    onKeyPress={(event) => {\n                                        if (event.key === \"Enter\") {\n                                            onSearch();\n                                        }\n                                    }}\n                                    autoComplete=\"off\"\n                                    placeholder=\"Nhập tên hoặc mã sản phẩm\"\n                                />\n                                <IconButton className={styles.iconButton} aria-label=\"search\" onClick={onSearch}>\n                                    <SearchIcon />\n                                </IconButton>\n                            </Paper>\n                        </Grid>\n                        <Grid item xs={6} sm={3} md={3}></Grid>\n                    </Grid>\n                </MyCardActions>\n            </MyCard>\n            <TableContainer component={Paper}>\n                <Table size=\"small\" aria-label=\"a dense table\">\n\n                    <TableHead>\n                        <TableRow>\n                            <TableCell align=\"left\">ID</TableCell>\n                            <TableCell align=\"left\">Hình ảnh</TableCell>\n                            <TableCell align=\"left\">Tên sản phẩm</TableCell>\n                            <TableCell align=\"left\">Mô tả</TableCell>\n                            <TableCell align=\"left\">Loại</TableCell>\n                            <TableCell align=\"left\">Giá</TableCell>\n                            <TableCell align=\"center\">Thao tác</TableCell>\n                        </TableRow>\n                    </TableHead>\n                    {data.count <= 0 ? (\n                        <TableRow>\n                            <TableCell colSpan={5} align=\"left\">\n                            </TableCell>\n                        </TableRow>\n                    ) : (\n                            <TableBody>\n                                {data.data.map((row, i) => (\n                                    <TableRow key={i}>\n                                        <TableCell component=\"th\" scope=\"row\">\n                                            {row.id}\n                                        </TableCell>\n                                        <TableCell>\n                                            <Image src={row.imageUrl ? row.imageUrl : \"/\"} title=\"image\" alt=\"image\" width={60} height={60} />\n                                        </TableCell>\n                                        <TableCell align=\"left\">{formatEllipsisText(row.name)}</TableCell>\n                                        <TableCell align=\"left\">{row.description}</TableCell>\n                                        <TableCell align=\"left\">{row.categoryId}</TableCell>\n                                        <TableCell align=\"left\">{row.price} vnđ</TableCell>\n                                        <TableCell align=\"center\">\n                                            <Link href={`/cms/product/edit?productId=${row.id}`}>\n                                                <a>\n                                                    <Tooltip title=\"Cập nhật thông tin\">\n                                                        <IconButton>\n                                                            <EditIcon fontSize=\"small\" />\n                                                        </IconButton>\n                                                    </Tooltip>\n                                                </a>\n                                            </Link>\n                                            <Tooltip title=\"Xóa sản phẩm\">\n                                                <IconButton>\n                                                    <DeleteIcon onClick={() => deleteProduct(row.id)} fontSize=\"small\" />\n                                                </IconButton>\n                                            </Tooltip>\n                                        </TableCell>\n                                    </TableRow>\n                                ))}\n                            </TableBody>\n                        )}\n                    {data.count > 0 ? (\n                        <MyTablePagination\n                            labelUnit=\"sản phẩm\"\n                            count={data.count}\n                            rowsPerPage={limit}\n                            page={page}\n                            onChangePage={(event, page, rowsPerPage) => {\n                                Router.push(`/cms/product?page=${page}&limit=${rowsPerPage}&search=${search}`);\n                            }}\n                        />\n                    ) : (\n                            <div />\n                        )}\n                </Table>\n            </TableContainer>\n        </div >\n    );\n}\n"]},"metadata":{},"sourceType":"module"}